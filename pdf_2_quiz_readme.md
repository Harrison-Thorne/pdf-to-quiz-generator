# üß† PDF-to-Quiz Generator

> **‰ªéÂ≠¶ÊúØ PDF Ëá™Âä®ÁîüÊàêÂü∫‰∫éÂõæÂÉèÁöÑÈÄâÊã©È¢òÊï∞ÊçÆÈõÜ**  
> _Extract figures, context, and auto-generate questions with AI_

---

## üåü È°πÁõÆÁÆÄ‰ªã

Êú¨È°πÁõÆÂÆûÁé∞‰∫Ü‰∏Ä‰∏™**‰ªé PDF Êñá‰ª∂‰∏≠Ëá™Âä®ÊèêÂèñÁ§∫‰æãÂõæË°®Âπ∂ÁîüÊàêÂØπÂ∫îÈÄâÊã©È¢ò**ÁöÑÂÆåÊï¥ÊµÅÊ∞¥Á∫ø„ÄÇ  
‰ªéÊèêÂèñÂõæÁâá„ÄÅÁîüÊàê‰∏ä‰∏ãÊñá„ÄÅAI Âá∫È¢òÂà∞Ê±áÊÄªÊàê ExcelÔºåÂÖ®ËøáÁ®ãËá™Âä®ÂåñÔºåÂèØÁî®‰∫éÊïôÂ≠¶„ÄÅÈ¢òÂ∫ìÊûÑÂª∫ÊàñÊ®°ÂûãËÆ≠ÁªÉ„ÄÇ

---

## üß© È°πÁõÆÁªìÊûÑ

```bash
project_root/
‚îÇ
‚îú‚îÄ‚îÄ pdf/                     # üì• ÊîæÁΩÆÊ∫ê PDF Êñá‰ª∂
‚îú‚îÄ‚îÄ raw_img/                 # üñºÔ∏è Á¨¨‰∏ÄÊ≠•ÊèêÂèñÁöÑÂéüÂßãÂõæÁâáÔºàÊåâ PDF ÂàÜÁ±ªÔºâ
‚îú‚îÄ‚îÄ img_set/                 # üìö Á¨¨‰∫åÊ≠•ÁîüÊàêÁöÑ‰∏ä‰∏ãÊñáÂõæÁâáÈõÜÔºàÊØèÂõæ‰∏Ä‰∏™Êñá‰ª∂Â§πÔºâ
‚îú‚îÄ‚îÄ pic2jsonl_output/        # üßæ Á¨¨‰∏âÊ≠• AI ËæìÂá∫ÁöÑ JSONL È¢òÁõÆÊï∞ÊçÆ
‚îú‚îÄ‚îÄ final_excel_output/      # üìä Á¨¨ÂõõÊ≠•ÂêàÂπ∂ËæìÂá∫ÁöÑ Excel Êñá‰ª∂
‚îÇ
‚îú‚îÄ‚îÄ extract_pdf2img.py       # Step 1: ÊèêÂèñ PDF ÂõæÁâá‰∏é caption ÂèØÈÄâÊã©excessiveÂíåinadequate‰∏§‰∏™ÁâàÊú¨Â∞ùËØï
‚îú‚îÄ‚îÄ figTo4bgImg.py           # Step 2: ÁîüÊàêÊØèÂõæÁöÑ‰∏ä‰∏ãÊñáÈ°µÂêàÈõÜ
‚îú‚îÄ‚îÄ autointerface_build_jsonl.py  # Step 3: Ë∞ÉÁî® API ÁîüÊàêÈ¢òÁõÆ JSONL
‚îî‚îÄ‚îÄ jsonl_to_xlsx.py         # Step 4: Ê±áÊÄªÊâÄÊúâ JSONL ‰∏∫ Excel
```

---

## üöÄ ‰ΩøÁî®ÊµÅÁ®ã

### ü•á Step 1: ÊèêÂèñ PDF ÂõæÁâá

## Excessive Áâà

### üåü È°πÁõÆÁÆÄ‰ªã
Êú¨ÁâàÊú¨ÂØπÂ∫îËÑöÊú¨ **`1.extract_pdf2img_excessive.py`**ÔºåÂÆûÁé∞‰∫ÜÊõ¥ÊøÄËøõÁöÑÂõæÂÉèÊèêÂèñÁ≠ñÁï•Ôºö
* **Áü¢ÈáèÂÖÉÁ¥†ËÅöÁ±ª** ÔºöÂêàÂπ∂Áõ¥Á∫ø„ÄÅÁü©ÂΩ¢‰∏éÊõ≤Á∫øÔºåËØÜÂà´ÂõæË°®/Ë°®Ê†ºÂå∫Âùó„ÄÇ
* **ÂõõÊñπÂêë Caption ÊêúÁ¥¢** ÔºöÂú®Âõæ‰∏ä‰∏ãÂ∑¶Âè≥Âä®ÊÄÅÁ™óÂè£‰∏≠Êô∫ËÉΩÊäΩÂèñÊ†áÈ¢òÊñáÂ≠ó„ÄÇ
* **Ê≠£ÊñáÂùóËøáÊª§** ÔºöÁªìÂêàÊñáÊú¨ÂØÜÂ∫¶‰∏éËæπÁºòÂº∫Â∫¶ÔºåËá™Âä®Ë∑≥ËøáÁ∫ØÊñáÂ≠óÊà™Âõæ„ÄÇ
* **Â§öÈáçÂéªÈáç** ÔºöÂü∫‰∫é *pHash* ‰∏éÈòàÂÄºÂàóË°®ÔºåÈÅøÂÖç‰øùÂ≠òÁõ∏‰ººÂõæÁâá„ÄÇ

‰∏éÂéüÊµÅÊ∞¥Á∫øÂÖ∂ÂÆÉÊ≠•È™§Ôºà`figTo4bgImg.py` Á≠âÔºâ‰øùÊåÅÂÖºÂÆπÔºåÂè™ÈúÄÂú® *Step 1* ‰ΩøÁî®Êú¨ËÑöÊú¨„ÄÇ

```bash
python 1.extract_pdf2img_excessive.py
```
> Ê≥®ÊÑèÔºöÁî±‰∫éËØÜÂà´Êõ¥ÊøÄËøõÔºå**ËæìÂá∫ÂõæÁâáÊï∞ÈáèÂèØËÉΩÊòæËëóÂ¢ûÂ§ö**ÔºåÂª∫ËÆÆÂêéÁª≠Ê≠•È™§ÁªìÂêà‰∫∫Â∑•ÊäΩÊ†∑È™åËØÅ„ÄÇ

#### ÂÖ≥ÈîÆÂèÇÊï∞
| ÂèÇÊï∞ | ‰ΩúÁî® | ÈªòËÆ§ÂÄº |
|---|---|---|
| `MIN_IMG_WIDTH` / `MIN_IMG_HEIGHT` | ÊúÄÂ∞èÂõæÁâáÂ∞∫ÂØ∏ËøáÊª§ | 200 / 100 |
| `HASH_THRESHOLD` | pHash ÂéªÈáçÈòàÂÄº | 5 |
| `HASH_FUNC` | ÂìàÂ∏åÁÆóÊ≥ï | `imagehash.phash` |
| `SEARCH_MARGIN` | Caption ÊêúÁ¥¢Âü∫Á°ÄÁ™óÂè£ (px) | 30 |
| `LINE_GAP_STOP` | Ë°åË∑ùÁªàÊ≠¢ÈòàÂÄº (px) | 18 |
| `WORD_JOIN_GAP` | Ë°åÂÜÖËØçÊãºÊé•Èó¥Èöî (px) | 6 |
| `CAPTION_MIN_LEN` | Caption ÊúÄÁü≠ÈïøÂ∫¶ | 8 |
| `MERGE_DIST` | Áü¢ÈáèÂÖÉÁ¥†ÂêàÂπ∂Ë∑ùÁ¶ª (px) | 12 |
| `MIN_GRAPHIC_W` / `MIN_GRAPHIC_H` | Âõæ/Ë°®Âà§ÂÆöÊúÄÂ∞èÂÆΩÈ´ò | 120 / 80 |
| `CHART_LINE_MIN` | ÊäòÁ∫ø/ÂùêÊ†áËΩ¥Á∫øÊÆµÈòàÂÄº | 6 |
| `BAR_RECT_MIN` | Êü±Áä∂ÂõæÁü©ÂΩ¢ÈòàÂÄº | 3 |
| `GRID_HV_MIN` | Ë°®Ê†ºÁΩëÊ†ºÁ∫øÈòàÂÄº (H,V) | (3,3) |

> ÂÖ∂‰ΩôÊú™ÂàóÂá∫ÂèÇÊï∞‰øùÊåÅ‰∏éËÑöÊú¨ÈªòËÆ§‰∏ÄËá¥„ÄÇ

#### ËæìÂá∫
- ÂõæÁâáË∑ØÂæÑÔºö`raw_img/{pdf_name}/*.png`
- ËæÖÂä© JSONÔºö`raw_img/{pdf_name}/{pdf_name}.json` ‚Äì ‰øùÂ≠ò page / caption / context Á≠â‰ø°ÊÅØ„ÄÇ

### üìà ÈÄÇÁî®Âú∫ÊôØ
- ÈúÄË¶ÅÊúÄÂ§ßÂåñË¶ÜÁõñËÆ∫Êñá‰∏≠ÊâÄÊúâÂõæË°®„ÄÅË°®Ê†º„ÄÅÁ§∫ÊÑèÂõæÔºõ
- ÂÖÅËÆ∏ÂêéÁª≠Á≠õÈÄâÂÜó‰ΩôÊàñËØØÊ£ÄÔºõ
- Á°Æ‰øù Caption ÊäΩÂèñÁéáÈ´ò„ÄÇ

---

## Inadequate Áâà

### üåü È°πÁõÆÁÆÄ‰ªã
Êú¨ÁâàÊú¨ÂØπÂ∫îËÑöÊú¨ **`1.extract_pdf2img_Inadequate.py`**ÔºåÂÆûÁé∞‰∫ÜÊúÄÁÆÄÊèêÂèñÊµÅÁ®ãÔºö
* ‰ªÖÂ§ÑÁêÜ PDF ‰∏≠ÂµåÂÖ•ÁöÑ **Ê†ÖÊ†ºÂõæÂÉè**Ôºõ
* Caption ‰ªÖÂú®ÂõæÁâá‰∏ãÊñπ‰∏ÄË°åÂÜÖÁÆÄÂçïÂåπÈÖçÔºõ
* ÂéªÈáçÁ≠ñÁï•Âè™ÊØîËæÉ‰∏é‰∏ä‰∏ÄÂº†‰øùÁïôÂõæÁâáÁöÑ *pHash*„ÄÇ

ÈÄüÂ∫¶Âø´„ÄÅ‰æùËµñÂ∞ëÔºå‰ΩÜÂèØËÉΩÊºèÊéâÁü¢ÈáèÁªòÂà∂ÁöÑË°®Ê†º/ÂõæË°®„ÄÇ

```bash
python 1.extract_pdf2img_Inadequate.py
```
> Ëã•‰ªÖÈúÄÂø´ÈÄü Demo ÊàñÂØπÁ≤æÂ∫¶Ë¶ÅÊ±Ç‰∏çÈ´òÔºåÂèØÈÄâÁî®Êú¨ËÑöÊú¨„ÄÇ

#### ÂÖ≥ÈîÆÂèÇÊï∞
| ÂèÇÊï∞ | ‰ΩúÁî® | ÈªòËÆ§ÂÄº |
|---|---|---|
| `MIN_IMG_WIDTH` / `MIN_IMG_HEIGHT` | ÊúÄÂ∞èÂõæÁâáÂ∞∫ÂØ∏ËøáÊª§ | 200 / 100 |
| `HASH_THRESHOLD` | pHash ÂéªÈáçÈòàÂÄº | 5 |
| `HASH_FUNC` | ÂìàÂ∏åÁÆóÊ≥ï | `imagehash.phash` |

ÂÖ∂‰ΩôÊ≠•È™§ÁÆóÊ≥ïÊ≤øÁî®ÊóßÁâà README„ÄÇËã•ÈúÄÂ§ÑÁêÜÂõæË°®/Ë°®Ê†ºÔºåËØ∑ÊîπÁî® *Excessive* ÁâàÊú¨„ÄÇ

### üöß Â±ÄÈôê
- Êó†Ê≥ïËØÜÂà´Á∫ØÁü¢ÈáèÁªòÂà∂ÁöÑÊõ≤Á∫øÊàñË°®Ê†ºÔºõ
- Caption ÊäΩÂèñ‰ªÖÊîØÊåÅËã±Êñá "Fig / Table" ÂºÄÂ§¥Ê†ºÂºèÔºõ
- ‰ªÖ‰∏é‰∏ä‰∏ÄÂº†ÂõæÁâáÊØîËæÉÔºåÊó†Ê≥ïÊ£ÄÊµãÈöîÈ°µÈáçÂ§ç„ÄÇ

---

### ü•à Step 2: ÁîüÊàêÂõõÈ°µ‰∏ä‰∏ãÊñáÂõæÈõÜ

```bash
python figTo4bgImg.py
```

ËØªÂèñ `raw_img/`ÔºåÊ†πÊçÆÂõæÁâáÊñá‰ª∂Âêç‰∏≠ÁöÑÈ°µÁ†ÅÔºå‰ªé `pdf/` ‰∏≠Ê∏≤Êüì‰∏ä‰∏ãÊñáÈ°µÔºàN-1„ÄÅN„ÄÅN+1ÔºâÔºåÁîüÊàêÂõõÂõæÂêàÈõÜ„ÄÇ

**‰∏ªË¶ÅÂèÇÊï∞** | **‰ΩúÁî®** | **ÈªòËÆ§ÂÄº**
---|---|---
`RENDER_DPI` | Ê∏≤ÊüìÊ∏ÖÊô∞Â∫¶ÔºàÊï∞ÂÄºË∂äÈ´òË∂äÊ∏ÖÊô∞Ôºâ | 220
`SKIP_IF_EXISTS` | ÊòØÂê¶Ë∑≥ËøáÂ∑≤Â≠òÂú®Êñá‰ª∂ | True
`PDF_DIR`, `RAW_IMG_DIR`, `OUTPUT_BASE_DIR` | Ëá™ÂÆö‰πâË∑ØÂæÑ | ËßÅËÑöÊú¨ÂÆö‰πâ

üìÅ ËæìÂá∫Ôºö`img_set/{ÂõæÂÉèÊñá‰ª∂Âêç}/` ‰∏≠ÂåÖÂê´ 4 Âº†ÂõæÁâáÔºàÂéüÂõæ + ‰∏ä‰∏ãÊñáÈ°µÔºâ„ÄÇ

---

### ü•â Step 3: AI Âá∫È¢òÁîüÊàê JSONL

```bash
python autointerface_build_jsonl.py
```

Â∞ÜÊØè‰∏™ `img_set/` Êñá‰ª∂Â§π‰∏ãÁöÑÂõõÂº†ÂõæÂèëÈÄÅÂà∞ AI Êé•Âè£ÔºåÁî± GPT-4o Ê®°ÂûãÁîüÊàêÂåÖÂê´È¢òÁõÆ„ÄÅÈÄâÈ°π„ÄÅÁ≠îÊ°à„ÄÅËß£ÊûêÁöÑ JSON„ÄÇ

**‰∏ªË¶ÅÂèÇÊï∞** | **ËØ¥Êòé** | **ÈªòËÆ§ÂÄº**
---|---|---
`API_BASE` | API Âú∞ÂùÄ | `https://api.ai-gaochao.cn/v1`
`API_MODEL` | Ê®°ÂûãÂêçÁß∞ | `gpt-4o`
`API_KEY` | API ÂØÜÈí•ÔºàÊé®ËçêËÆæ‰∏∫ÁéØÂ¢ÉÂèòÈáè `AIGC_API_KEY`Ôºâ | Ëá™Ë°åËÆæÁΩÆ
`EXPECTED_PNG_COUNT` | ÊØèÁªÑÊúüÊúõÂõæÁâáÊï∞ | 4
`RETRY_TOTAL` / `RETRY_BACKOFF` | ËØ∑Ê±ÇÈáçËØïÁ≠ñÁï• | 3 / 1.5
`TIMEOUT` | ËøûÊé•‰∏éËØªÂèñË∂ÖÊó∂ | (10, 120)

üìÅ ËæìÂá∫Ôºö`pic2jsonl_output/dataset.jsonl`  
ü™µ Êó•ÂøóÔºö`build_jsonl_logs/run.log`

---

### üèÅ Step 4: ÂêàÂπ∂ JSONL ‰∏∫ Excel

```bash
python jsonl_to_xlsx.py
```

Â∞ÜÊâÄÊúâ `pic2jsonl_output/*.jsonl` ÂêàÂπ∂‰∏∫‰∏Ä‰∏™ Excel Êñá‰ª∂Ôºö

**ÂëΩ‰ª§ÂèÇÊï∞** | **‰ΩúÁî®** | **ÈªòËÆ§ÂÄº**
---|---|---
`-d / --dir` | ËæìÂÖ• JSONL ÁõÆÂΩï | `./pic2jsonl_output`
`-o / --output` | ËæìÂá∫ Excel Êñá‰ª∂Ë∑ØÂæÑ | `./final_excel_output/finalOutput.xlsx`
`--sep` | Â±ïÂºÄ JSON ÁöÑÂ≠óÊÆµÂàÜÈöîÁ¨¶ | `.`
`--sheet-name` | Excel Â∑•‰ΩúË°®ÂêçÁß∞ | `Sheet1`

üìÅ ËæìÂá∫Ôºö`final_excel_output/finalOutput.xlsx`

---

## ‚öôÔ∏è ÁéØÂ¢É‰æùËµñ

```bash
pip install pdfplumber PyPDF2 pillow imagehash pymupdf requests openpyxl pandas
```

ÂèØÈÄâ‰æùËµñÔºàÁî®‰∫éÊõ¥ÁæéËßÇÁöÑÊó•ÂøóÊòæÁ§∫ÔºâÔºö
```bash
pip install tqdm
```

---

## üìä ÊúÄÁªàËæìÂá∫Á§∫‰æã

| pdf | page | originID | question | options | answer | analysis | pic |
|------|------|-----------|-----------|----------|----------|-----------|------|
| sample.pdf | 23 | Fig 1.2 | Which region corresponds to... | [A. ..., B. ..., C. ..., D. ...] | B | Âõ†‰∏∫ËØ•Êõ≤Á∫øÂ§Ñ‰∫é... | sample_p23_FIG1.2.png |

Excel Êñá‰ª∂Ë∑ØÂæÑÔºö`final_excel_output/finalOutput.xlsx`

---

## üß∞ Ë∞ÉËØï‰∏éÊäÄÂ∑ß

- ‚úÖ Á°ÆËÆ§ÊØèÊ≠•ËæìÂá∫ÁõÆÂΩïÂ≠òÂú®ÂÜçÊâßË°å‰∏ã‰∏ÄÊ≠•Ôºõ
- üîë ËØ∑Âä°ÂøÖÂä°ÂøÖÂä°ÂøÖÂ°´ÂÜôÂπ∂Ê£ÄÊü•Á¨¨‰∏â‰∏™py‰ª£Á†Å‰∏≠ `API_KEY` ÊòØÂê¶ÊúâÊïàÔºåÂê¶Âàô‰ºöËøîÂõû 401Ôºõ
- üöÄ ÂèØË∑≥ËøáÊüêÊ≠•Áõ¥Êé•‰ΩøÁî®‰∏≠Èó¥ÁªìÊûúÁõÆÂΩïÔºõ
- üß± ÊîØÊåÅÊâπÈáè PDF Ëá™Âä®Â§ÑÁêÜÔºåÁªìÊûúËá™Âä®Ê±áÊÄªÔºõ
- üß™ Ëã•ÊÉ≥ÁîüÊàêÊõ¥Ê∏ÖÊô∞ÁöÑ‰∏ä‰∏ãÊñáÂõæÔºåÂèØÈÄÇÂΩìÊèêÈ´ò `RENDER_DPI`„ÄÇ

---

## üìú License

Êú¨È°πÁõÆÈÅµÂæ™ **MIT License**„ÄÇ

---

## ‚ù§Ô∏è Ëá¥Ë∞¢

ÊÑüË∞¢‰ª•‰∏ãÂºÄÊ∫êÈ°πÁõÆÔºö
- [PyMuPDF](https://pymupdf.readthedocs.io/)
- [pdfplumber](https://github.com/jsvine/pdfplumber)
- [imagehash](https://pypi.org/project/ImageHash/)
- [pandas](https://pandas.pydata.org/)

> Made with ‚ù§Ô∏è by MY

